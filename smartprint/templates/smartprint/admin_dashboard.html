{% load custom_filters %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard - SmartXerox</title>
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            margin: 0; 
            padding: 0; 
            background-color: #f0f2f5;
            display: flex; /* Use flexbox for main layout */
            min-height: 100vh; /* Ensure full viewport height */
        }
        /* Sidebar Styles */
        .sidebar {
            width: 250px;
            background-color: #2c3e50; /* Darker sidebar background */
            color: white;
            padding: 20px;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 40px;
            flex-shrink: 0; /* Prevent sidebar from shrinking */
        }
        .sidebar h2 {
            color: #ecf0f1; /* Light text for sidebar heading */
            margin-bottom: 30px;
            font-size: 1.8em;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 15px;
            width: 100%;
            text-align: center;
        }
        .sidebar-menu {
            list-style: none;
            padding: 0;
            margin: 0;
            width: 100%;
        }
        .sidebar-menu li {
            margin-bottom: 10px;
        }
        .sidebar-menu a {
            display: block;
            color: #bdc3c7; /* Lighter grey for menu items */
            text-decoration: none;
            padding: 12px 15px;
            border-radius: 8px;
            transition: background-color 0.2s ease, color 0.2s ease;
            font-size: 1.1em;
        }
        .sidebar-menu a:hover {
            background-color: #34495e; /* Darker on hover */
            color: white;
        }
        .sidebar-profile {
            margin-top: auto; /* Pushes profile to the bottom */
            padding-top: 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
            width: 100%;
            text-align: center;
            font-size: 0.9em;
            color: #bdc3c7;
        }
        .sidebar-profile a {
            color: #3498db; /* Blue for logout link */
            text-decoration: none;
            margin-top: 10px;
            display: block;
        }
        .sidebar-profile a:hover {
            text-decoration: underline;
        }

        /* Main Content Area */
        .main-content {
            flex-grow: 1; /* Takes remaining space */
            padding: 30px;
            background-color: #f0f2f5;
            overflow-y: auto; /* Enable scrolling if content overflows */
        }
        .dashboard-container { 
            max-width: 100%; /* Adjust to fit main-content */
            margin: 0 auto; /* Center within main-content */
            padding: 30px; 
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.08);
        }
        h1 { 
            color: #2c3e50; 
            text-align: center; 
            margin-bottom: 40px; 
            font-size: 2.5em; 
            font-weight: 700; 
        }
        h2 { 
            color: #34495e; 
            margin-top: 30px; 
            margin-bottom: 20px; 
            border-bottom: 2px solid #e0e0e0; 
            padding-bottom: 8px; 
            font-size: 1.8em;
            font-weight: 600;
        }
        
        /* Card Styles */
        .card-row { 
            display: flex; 
            justify-content: space-around; 
            flex-wrap: wrap; 
            margin-bottom: 40px; 
        }
        .card { 
            flex: 1; 
            min-width: 280px; 
            margin: 15px; 
            padding: 30px; 
            background: linear-gradient(145deg, #f0f4f8, #e0e6ed); 
            text-align: center; 
            border-radius: 15px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
        }
        .card:hover {
            transform: translateY(-8px); 
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        .card h2 { 
            font-size: 1.4em; 
            margin-top: 0; 
            color: #4a69bd; 
            border-bottom: none; 
            font-weight: 600;
        }
        .card p { 
            font-size: 2.8em; 
            font-weight: bold; 
            color: #1abc9c; 
            margin: 10px 0; 
        }
        .card p.currency { 
            font-size: 2.2em; 
            color: #2ecc71; 
        }

        /* Table Styles */
        .order-table { 
            width: 100%; 
            border-collapse: separate; 
            border-spacing: 0;
            margin-top: 25px; 
            border-radius: 10px; 
            overflow: hidden; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .order-table th, .order-table td { 
            border: none; 
            padding: 15px; 
            text-align: left; 
            font-size: 1em;
        }
        .order-table th { 
            background-color: #3498db; 
            color: white; 
            font-weight: bold; 
            text-transform: uppercase; 
            letter-spacing: 0.05em;
        }
        .order-table tr:first-child th:first-child { border-top-left-radius: 10px; }
        .order-table tr:first-child th:last-child { border-top-right-radius: 10px; }
        .order-table tr:last-child td:first-child { border-bottom-left-radius: 10px; }
        .order-table tr:last-child td:last-child { border-bottom-right-radius: 10px; }

        .order-table tr:nth-child(even) { background-color: #f8f8f8; } 
        .order-table tr:nth-child(odd) { background-color: #ffffff; } 
        .order-table tr:hover { background-color: #eaf6ff; } 

        /* Nested table for job items */
        .job-items-table { 
            width: 100%; 
            border-collapse: collapse; 
            margin-top: 10px; 
            font-size: 0.9em;
            background-color: #fdfdfd; 
            border-radius: 8px; 
            overflow: hidden;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.05); /* Inner shadow for nested table */
        }
        .job-items-table th, .job-items-table td { 
            border: 1px solid #eee; 
            padding: 10px; 
            text-align: left; 
        }
        .job-items-table th { 
            background-color: #7f8c8d; 
            color: white; 
            font-weight: normal; 
        }
        .job-items-table tr:nth-child(even) { background-color: #fbfbfb; }

        /* Button Styles */
        .btn-action {
            display: inline-block;
            padding: 10px 18px; 
            margin: 5px; 
            border-radius: 6px; 
            text-decoration: none;
            color: white;
            font-weight: bold;
            font-size: 0.95em;
            transition: background-color 0.2s ease, transform 0.1s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); 
        }
        .btn-action:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        .btn-action:active {
            transform: translateY(0);
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .btn-print { background-color: #3498db; } 
        .btn-print:hover { background-color: #2980b9; }
        .btn-print-greyed { 
            background-color: #bdc3c7 !important; 
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }
        .btn-print-greyed:hover {
            background-color: #bdc3c7 !important;
            transform: none;
            box-shadow: none;
        }

        .btn-approve { background-color: #2ecc71; } 
        .btn-approve:hover { background-color: #27ae60; }
        .btn-reject { background-color: #e74c3c; } 
        .btn-reject:hover { background-color: #c0392b; }
        .btn-primary { background-color: #9b59b6; } 
        .btn-primary:hover { background-color: #8e44ad; }

        .status-pending { color: #f39c12; font-weight: bold; } 
        .status-approved { color: #3498db; font-weight: bold; } 
        .status-in_progress { color: #8e44ad; font-weight: bold; } 
        .status-completed { color: #27ae60; font-weight: bold; } 
        .status-rejected { color: #e74c3c; font-weight: bold; } 

        /* Responsive adjustments */
        @media (max-width: 768px) {
            body {
                flex-direction: column; /* Stack sidebar and main content */
            }
            .sidebar {
                width: 100%;
                padding: 15px 0;
                height: auto;
                box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                padding-top: 20px;
            }
            .sidebar h2 {
                margin-bottom: 15px;
                padding-bottom: 10px;
            }
            .sidebar-menu {
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
            }
            .sidebar-menu li {
                margin: 5px 10px;
            }
            .sidebar-menu a {
                padding: 8px 12px;
            }
            .sidebar-profile {
                margin-top: 15px;
                padding-top: 15px;
            }
            .main-content {
                padding: 15px;
            }
            .dashboard-container {
                padding: 20px;
            }
            .card {
                min-width: 100%;
                margin: 10px 0;
            }
            .order-table, .job-items-table {
                font-size: 0.85em;
            }
            .order-table th, .order-table td, .job-items-table th, .job-items-table td {
                padding: 10px;
            }
            .btn-action {
                padding: 8px 12px;
                font-size: 0.8em;
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="sidebar">
        <h2>Admin Menu</h2>
        <ul class="sidebar-menu">
            <!-- smartprint/templates/smartprint/admin_dashboard.html -->
<!-- ... (inside the sidebar-menu ul) ... -->
            <li><a href="{% url 'admin_dashboard' %}">Dashboard</a></li>
            <li><a href="{% url 'admin:app_list' 'smartprint' %}">Manage Models</a></li>
            <li><a href="{% url 'admin_profile' %}">Profile & Analytics</a></li> {# Updated link for profile/analytics #}
            <li><a href="#">Settings</a></li> {# Placeholder for future settings page #}
<!-- ... (rest of the template) ... -->
        </ul>
        <div class="sidebar-profile">
            Logged in as: {{ user.username }}<br>
            <a href="{% url 'logout' %}">Logout</a>
        </div>
    </div>
    <div class="main-content">
        <div class="dashboard-container">
            <h1>Welcome, Admin!</h1>
            <div class="card-row">
                <div class="card">
                    <h2>Total Orders Today</h2>
                    <p>{{ total_jobs_today }}</p>
                </div>
                {# Removed Earnings Today card as requested #}
                <div class="card">
                    <h2>Pages Printed Today</h2>
                    <p>{{ total_pages_printed_today }}</p>
                </div>
            </div>

            <h2>Pending Print Orders</h2>
            {% if pending_orders %}
            <table class="order-table">
                <thead>
                    <tr>
                        <th>Order ID</th>
                        <th>User</th>
                        <th>Requested At</th>
                        <th>Total Cost</th>
                        <th>Order Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for order in pending_orders %}
                    <tr>
                        <td>{{ order.id }}</td>
                        <td>{{ order.user.username }}</td>
                        <td>{{ order.requested_at|date:"M d, Y H:i" }}</td>
                        <td>₹ {{ order.total_estimated_cost }}</td>
                        <td>
                            <!-- Order Actions based on status -->
                            {% if order.status == 'PENDING' %}
                                <a href="{% url 'approve_order' order.id %}" class="btn-action btn-approve">Approve Order</a>
                                <a href="{% url 'reject_order' order.id %}" class="btn-action btn-reject">Reject Order</a>
                            {% elif order.status == 'APPROVED' %}
                                <a href="{% url 'complete_order' order.id %}" class="btn-action btn-approve">Mark as Completed</a>
                                {% if order.payment_status == 'PENDING' %}
                                    <a href="{% url 'mark_as_paid_order' order.id %}" class="btn-action btn-primary">Mark as Paid</a>
                                {% else %}
                                    <span style="color: green; font-weight: bold;">(Paid)</span>
                                {% endif %}
                                <span style="color: blue; font-weight: bold;">(Approved)</span>
                            {% elif order.status == 'COMPLETED' %}
                                <span style="color: green; font-weight: bold;">Completed</span>
                                {% if order.payment_status == 'PENDING' %}
                                    <a href="{% url 'mark_as_paid_order' order.id %}" class="btn-action btn-primary">Mark as Paid</a>
                                {% else %}
                                    <span style="color: green; font-weight: bold;">(Paid)</span>
                                {% endif %}
                            {% elif order.status == 'REJECTED' %}
                                <span style="color: red; font-weight: bold;">Rejected</span>
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <td colspan="5">
                            <h3 style="margin-top: 10px; margin-bottom: 5px;">Order Items (Documents)</h3>
                            <table class="job-items-table">
                                <thead>
                                    <tr>
                                        <th>Item ID</th>
                                        <th>Document Name</th>
                                        <th>Pages</th>
                                        <th>Copies</th>
                                        <th>Customizations</th>
                                        <th>Item Cost</th>
                                        <th>Item Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for item in order.items.all %} {# Iterate through related PrintJob items #}
                                    <tr>
                                        <td>{{ item.id }}</td>
                                        <td>
                                            {{ item.document.name|split:"/"|last }}
                                            {% if item.total_pages %} ({{ item.total_pages }} pages){% endif %}
                                        </td>
                                        <td>{{ item.num_copies }}</td>
                                        <td>
                                            Print Type: {% if item.is_color %}Color{% else %}B&W{% endif %}<br>
                                            Binding: {% if item.needs_binding %}Yes{% else %}No{% endif %}
                                            {% if item.color_pages_info %} ({{ item.color_pages_info }}){% endif %}
                                        </td>
                                        <td>₹ {{ item.item_estimated_cost }}</td>
                                        <td>
                                            <a href="{% url 'print_job_document' order.id item.id %}" 
                                               class="btn-action btn-print {% if item.is_printed_by_admin %}btn-print-greyed{% endif %}"
                                               {% if item.is_printed_by_admin %}style="pointer-events: none; opacity: 0.6;"{% endif %}
                                               target="_blank">
                                               Print Item
                                            </a>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p style="text-align: center; color: #666; font-style: italic;">No pending print orders at the moment.</p>
            {% endif %}
        </div>
    </div>
</body>
</html>
